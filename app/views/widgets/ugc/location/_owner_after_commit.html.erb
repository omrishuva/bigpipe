<div class=googleMapContainer>
  <%=cl_image_tag("Map_Marker-30_uvmgwm.png", :width=>20, :crop=>"scale", secure: true)%>
	<%=render "widgets/ugc/text/button", 
			locals: locals.merge( 
															class: "fa fa-pencil #{current_direction.to_s}", 
															state: "edit", 
															button_text: "edit" )
  %>
  <div id="map"></div>
</div>

<script>
  function initMap( ) {
    // var event;
    // event = new CustomEvent( 'initMap', { 'detail': } );
    // document.dispatchEvent(event);
    document.publishEvent('initMap', { 'place_id': "<%=locals[:value]%>" }  )
    // var evt = document.createEvent("initMap");
    // evt.initEvent("custom", true, false);
    // document.dispatchEvent(evt); 
  }
</script>

<%unless params[:loadScriptAfterServerResponse] == "false" %>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCNaxhT2SJvK6MwGjYHB7pZB0Al0IYTknw&libraries=places&callback=initMap"
      async defer>
  </script>
<%else%>
  <script>initMap()</script>
<%end%>